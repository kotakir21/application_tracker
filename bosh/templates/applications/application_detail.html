{% extends "base.html" %}

{% block title %}Application Details{% endblock %}

{% block content %}
<div class="container">
    <h2>Application Details</h2>
    <dl class="row">
        <dt class="col-sm-3">Program:</dt>
        <dd class="col-sm-9">{{ application.program.name }}</dd>

        <dt class="col-sm-3">Full Name:</dt>
        <dd class="col-sm-9">{{ application.full_name }}</dd>

        <dt class="col-sm-3">Email:</dt>
        <dd class="col-sm-9">{{ application.email }}</dd>

        <dt class="col-sm-3">Phone:</dt>
        <dd class="col-sm-9">{{ application.phone }}</dd>

        <dt class="col-sm-3">Resume:</dt>
        <dd class="col-sm-9"><a href="{{ application.resume.url }}" class="btn btn-link">Download Resume</a></dd>

        <dt class="col-sm-3">Passport:</dt>
        <dd class="col-sm-9"><a href="{{ application.passport.url }}" class="btn btn-link">Download Passport</a></dd>

        <dt class="col-sm-3">Cover Letter:</dt>
        <dd class="col-sm-9"><a href="{{ application.cover_letter.url }}" class="btn btn-link">Download Cover Letter</a></dd>

        <dt class="col-sm-3">Travel Plan:</dt>
        <dd class="col-sm-9">{{ application.travel_plan }}</dd>

        <dt class="col-sm-3">Date of Application:</dt>
        <dd class="col-sm-9">{{ application.date_of_application }}</dd>

        <dt class="col-sm-3">Current Status:</dt>
        <dd class="col-sm-9">{{ application.current_status.status if application.current_status else "No status updates yet" }}</dd>
    </dl>

    <!-- Timeline of Events -->
    <h4>Timeline of Events</h4>
    <div class="timeline">
        {% for event in timeline_events %}
            <div class="timeline-item">
                <div class="timeline-icon"></div>
                <div class="timeline-content">
                    <h5 class="timeline-title">{{ event.description }}</h5>
                    <p class="text-muted">{{ event.timestamp|date:"SHORT_DATE_FORMAT" }} at {{ event.timestamp|time:"H:i" }}</p>
                </div>
            </div>
        {% empty %}
            <p>No events recorded yet.</p>
        {% endfor %}
    </div>

    <!-- Upload Additional Documents -->
    {% if application.current_status and application.current_status.additional_documents_required %}
        <h4>Upload Additional Documents</h4>
        <form method="post" enctype="multipart/form-data" action="{% url 'upload_documents' application.id %}">
            {% csrf_token %}
            {{ upload_form.as_p }}
            <button type="submit" class="btn btn-primary">Upload</button>
        </form>
    {% endif %}

    <a href="{% url 'user_dashboard' %}" class="btn btn-secondary mt-3">Back to Dashboard</a>
</div>

<style>
    .timeline {
        position: relative;
        padding: 0 0 20px 30px;
        margin-bottom: 30px;
        list-style: none;
    }

    .timeline:before {
        content: '';
        position: absolute;
        top: 0;
        bottom: 0;
        left: 15px;
        width: 2px;
        background: #ddd;
    }

    .timeline-item {
        margin-bottom: 20px;
        position: relative;
    }

    .timeline-icon {
        position: absolute;
        left: -25px;
        top: 0;
        width: 20px;
        height: 20px;
        background: #d32f2f;
        border-radius: 50%;
    }

    .timeline-content {
        margin-left: 30px;
        background: #f9f9f9;
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .timeline-title {
        font-size: 1.1em;
        font-weight: bold;
        color: #d32f2f;
        margin-bottom: 5px;
    }
</style>
{% endblock %}
